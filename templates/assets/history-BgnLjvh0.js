import{j as e,r as n,b as Q,u as _,c as G,O as V,H as W}from"./index-lW-lZBXM.js";import{F as f,p as $,q as M,l as U}from"./index.es-ClVZX2lA.js";const K=({isOpen:p,onClose:l,onConfirm:m,title:u,message:x})=>p?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative z-50 w-full max-w-md rounded-xl bg-white p-6 shadow-2xl",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",children:e.jsx("div",{className:"rounded-full bg-red-100 p-3",children:e.jsx(f,{icon:$,className:"h-6 w-6 text-red-500"})})}),e.jsx("h3",{className:"mb-2 text-center text-lg font-medium text-gray-900",children:u}),e.jsx("p",{className:"mb-6 text-center text-gray-500",children:x}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:l,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-all hover:bg-gray-50 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2",children:"Hủy"}),e.jsx("button",{onClick:()=>{m(),l()},className:"flex-1 rounded-lg bg-red-500 px-4 py-2 text-sm font-medium text-white transition-all hover:bg-red-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"Xác nhận"})]})]})]}):null,h=10,ee=()=>{const[p,l]=n.useState(!1),{id:m}=Q(),u=_(),x=G(),[y,T]=n.useState(1),[L,j]=n.useState(!1);n.useEffect(()=>{l(!!m)},[m,x.pathname]);const o=n.useCallback(()=>{const t=localStorage.getItem("scanResults");return t?Object.entries(JSON.parse(t)).map(([s,a])=>{var I,q,E,H,O,P,A;const d=((q=(I=a.results)==null?void 0:I.semgrep)==null?void 0:q.results)||[],N=d.filter(i=>{var g;return((g=i==null?void 0:i.extra)==null?void 0:g.severity)==="ERROR"}).length,k=d.filter(i=>{var g;return((g=i==null?void 0:i.extra)==null?void 0:g.severity)==="WARNING"}).length,r=((E=a.results)==null?void 0:E.bearer)||{},v=((H=r==null?void 0:r.critical)==null?void 0:H.length)??0,w=((O=r==null?void 0:r.high)==null?void 0:O.length)??0,S=((P=r==null?void 0:r.medium)==null?void 0:P.length)??0,C=((A=r==null?void 0:r.low)==null?void 0:A.length)??0,z=N+v+w,J=N+k+v+w+S+C;return{id:s,data:a,timestamp:s.split("-")[0],totalIssues:J,criticalIssues:z,semgrepErrors:N,semgrepWarnings:k,bearerCritical:v,bearerHigh:w,bearerMedium:S,bearerLow:C}}).sort((s,a)=>a.timestamp.localeCompare(s.timestamp)):[]},[]),[c,b]=n.useState(()=>o());n.useEffect(()=>{b(o())},[o,x.key]);const X=n.useCallback((t,s)=>{if(s.stopPropagation(),window.confirm("Bạn có chắc chắn muốn xóa kết quả quét này?")){const a=localStorage.getItem("scanResults");if(a){const d=JSON.parse(a);delete d[t],localStorage.setItem("scanResults",JSON.stringify(d)),b(o())}}},[o]),B=n.useCallback(()=>{localStorage.clear(),b([]),j(!1)},[]),D=(t,s)=>s>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-red-100 px-3 py-1 text-sm font-medium text-red-700",children:[s," Nghiêm trọng"]}),e.jsxs("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700",children:[t," Vấn đề"]})]}):e.jsxs("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700",children:[t," Vấn đề"]}),F=Math.ceil(c.length/h),R=c.slice((y-1)*h,y*h);return p?e.jsx(V,{}):e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsx("title",{children:"Lịch Sử Quét - FPT UniSAST"})}),e.jsx(K,{isOpen:L,onClose:()=>j(!1),onConfirm:B,title:"Xóa tất cả lịch sử?",message:"Bạn có chắc chắn muốn xóa tất cả lịch sử quét? Hành động này không thể hoàn tác."}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-white px-8 py-12",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsxs("div",{className:"relative mb-12",children:[e.jsx("div",{className:"sticky top-4 z-10 mb-4 flex justify-end",children:c.length>0&&e.jsxs("button",{onClick:()=>j(!0),className:"group flex items-center gap-2 rounded-lg bg-red-500 px-4 py-2 text-sm font-medium text-white transition-all hover:bg-red-600 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:[e.jsx(f,{icon:M,className:"h-4 w-4 transition-transform group-hover:scale-110"}),"Xóa Tất Cả"]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 sm:text-5xl",children:"Lịch Sử Quét"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Xem lại các kết quả quét mã nguồn trước đây"})]})]}),c.length===0?e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-12 text-center",children:[e.jsx(f,{icon:U,className:"h-12 w-12 text-gray-400"}),e.jsx("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"Chưa có lịch sử quét"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Bắt đầu quét mã nguồn để xem kết quả tại đây"}),e.jsx("button",{onClick:()=>u("/scan"),className:"mt-6 rounded-lg bg-gray-900 px-4 py-2 text-sm font-medium text-white transition-all hover:bg-gray-800 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2",children:"Quét Ngay"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:R.map(t=>e.jsx("div",{onClick:()=>u(`/history/${t.id}`),className:"group cursor-pointer rounded-xl border border-gray-200 bg-white p-6 shadow-sm transition-all focus-within:border-gray-300 focus-within:ring-2 focus-within:ring-gray-900 focus-within:ring-offset-2 hover:border-gray-300 hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 group-hover:text-gray-700",children:["ID: ",t.id]}),D(t.totalIssues,t.criticalIssues)]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:s=>X(t.id,s),className:"rounded-full p-2 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",title:"Xóa kết quả quét",children:e.jsx(f,{icon:M,className:"h-4 w-4"})})})]})},t.id))}),c.length>h&&e.jsx("div",{className:"mt-8 flex justify-center gap-2",children:Array.from({length:F},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>T(t),className:`rounded-lg px-4 py-2 text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 ${y===t?"bg-gray-900 text-white hover:bg-gray-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t},t))})]})})]})};export{ee as default};
