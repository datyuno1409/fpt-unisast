import{r as i,b as J,u as M,c as Q,j as e,O as _,H as G}from"./index-DvujZN1e.js";import{F as H,l as V,p as W}from"./index.es-bT6xLkJU.js";const m=10,U=()=>{const[P,O]=i.useState(!1),{id:f}=J(),y=M(),p=Q(),[u,A]=i.useState(1);i.useEffect(()=>{O(!!f)},[f,p.pathname]);const o=i.useCallback(()=>{const t=localStorage.getItem("scanResults");return t?Object.entries(JSON.parse(t)).map(([s,n])=>{var w,S,k,C,I,q,E;const c=((S=(w=n.results)==null?void 0:w.semgrep)==null?void 0:S.results)||[],d=c.filter(a=>{var l;return((l=a==null?void 0:a.extra)==null?void 0:l.severity)==="ERROR"}).length,N=c.filter(a=>{var l;return((l=a==null?void 0:a.extra)==null?void 0:l.severity)==="WARNING"}).length,r=((k=n.results)==null?void 0:k.bearer)||{},x=((C=r==null?void 0:r.critical)==null?void 0:C.length)??0,h=((I=r==null?void 0:r.high)==null?void 0:I.length)??0,b=((q=r==null?void 0:r.medium)==null?void 0:q.length)??0,v=((E=r==null?void 0:r.low)==null?void 0:E.length)??0,T=d+x+h,B=d+N+x+h+b+v;return{id:s,data:n,timestamp:s.split("-")[0],totalIssues:B,criticalIssues:T,semgrepErrors:d,semgrepWarnings:N,bearerCritical:x,bearerHigh:h,bearerMedium:b,bearerLow:v}}).sort((s,n)=>n.timestamp.localeCompare(s.timestamp)):[]},[]),[g,j]=i.useState(()=>o());i.useEffect(()=>{j(o())},[o,p.key]);const L=i.useCallback((t,s)=>{if(s.stopPropagation(),window.confirm("Bạn có chắc chắn muốn xóa kết quả quét này?")){const n=localStorage.getItem("scanResults");if(n){const c=JSON.parse(n);delete c[t],localStorage.setItem("scanResults",JSON.stringify(c)),j(o())}}},[o]),D=(t,s)=>s>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-red-100 px-3 py-1 text-sm font-medium text-red-700",children:[s," Nghiêm trọng"]}),e.jsxs("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700",children:[t," Vấn đề"]})]}):e.jsxs("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700",children:[t," Vấn đề"]}),F=Math.ceil(g.length/m),R=g.slice((u-1)*m,u*m);return P?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsx("title",{children:"Lịch Sử Quét - FPT UniSAST"})}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-gray-50 to-white px-8 py-12",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsxs("div",{className:"mb-12 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 sm:text-5xl",children:"Lịch Sử Quét"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Xem lại các kết quả quét mã nguồn trước đây"})]}),g.length===0?e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-12 text-center",children:[e.jsx(H,{icon:V,className:"h-12 w-12 text-gray-400"}),e.jsx("h2",{className:"mt-4 text-lg font-medium text-gray-900",children:"Chưa có lịch sử quét"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Bắt đầu quét mã nguồn để xem kết quả tại đây"}),e.jsx("button",{onClick:()=>y("/scan"),className:"mt-6 rounded-lg bg-gray-900 px-4 py-2 text-sm font-medium text-white transition-all hover:bg-gray-800 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2",children:"Quét Ngay"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:R.map(t=>e.jsx("div",{onClick:()=>y(`/history/${t.id}`),className:"group cursor-pointer rounded-xl border border-gray-200 bg-white p-6 shadow-sm transition-all focus-within:border-gray-300 focus-within:ring-2 focus-within:ring-gray-900 focus-within:ring-offset-2 hover:border-gray-300 hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 group-hover:text-gray-700",children:["ID: ",t.id]}),D(t.totalIssues,t.criticalIssues)]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:s=>L(t.id,s),className:"rounded-full p-2 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",title:"Xóa kết quả quét",children:e.jsx(H,{icon:W,className:"h-4 w-4"})})})]})},t.id))}),g.length>m&&e.jsx("div",{className:"mt-8 flex justify-center gap-2",children:Array.from({length:F},(t,s)=>s+1).map(t=>e.jsx("button",{onClick:()=>A(t),className:`rounded-lg px-4 py-2 text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 ${u===t?"bg-gray-900 text-white hover:bg-gray-800":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t},t))})]})})]})};export{U as default};
